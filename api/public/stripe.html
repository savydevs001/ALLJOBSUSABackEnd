<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stripe Card Payment</title>
    <script src="https://js.stripe.com/v3/"></script>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background: #f8f9fa;
      }
      .payment-container {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
        width: 400px;
      }
      .payment-container h2 {
        text-align: center;
        margin-bottom: 20px;
        color: #333;
      }
      #card-element {
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 8px;
        background: #f1f3f5;
      }
      #submit {
        width: 100%;
        margin-top: 20px;
        background-color: #5469d4;
        color: white;
        border: none;
        padding: 12px;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
      }
      #submit:hover {
        background-color: #3d51b2;
      }
      #error-message {
        color: red;
        margin-top: 10px;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div class="payment-container">
      <h2>Pay with Card</h2>
      <form id="payment-form">
        <input
          type="text"
          name="order_id"
          id="order_id"
          height="10"
          width="100"
        />
        <div id="card-element"><!-- Stripe Element will go here --></div>
        <button id="submit">Pay</button>
        <div id="error-message"></div>
      </form>
    </div>

    <script>
      const stripe = Stripe(
        "pk_test_51RhF0QB4zBNMJH4WtRKVvEwXzJglMV6vZaD7SBIu7HBsJjo6HMTluU6gFDnBNwk46hzklXIp8SY93ZRvt3OsW4LK00m3D4PbEX"
      ); // Replace with your Stripe publishable key
      const elements = stripe.elements();
      const cardElement = elements.create("card");
      cardElement.mount("#card-element");

      const form = document.getElementById("payment-form");
      const errorMessage = document.getElementById("error-message");

      let clientSecret;

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        errorMessage.textContent = "";

        if (!clientSecret) {
          try {
            const res = await fetch("/payments/create-intent", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization:
                  "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2ODY5NjY4ZDBlMmFmYzc3NzliMGQzMjYiLCJyb2xlIjpbImVtcGxveWVyIl0sImVtYWlsIjoiYWJjZDFAZ21haWwuY29tIiwiaWF0IjoxNzUxNzkxMTU4LCJleHAiOjE3NTQzODMxNTh9.RdHj_sBGT_ptZfbgozkKvinu9ESOFY1ZKSjxQYasB3E",
              },
              body: JSON.stringify({ orderId: e.target["order_id"].value }),
            });
            const data = await res.json();
            clientSecret = data.client_secret;
            console.log("clientSecret: ", clientSecret);
          } catch (err) {
            errorMessage.textContent = "Failed to initialize payment.";
            return;
          }
        }

        const { paymentIntent, error } = await stripe.confirmCardPayment(
          clientSecret,
          {
            payment_method: {
              card: cardElement,
            },
          }
        );

        if (error) {
          errorMessage.textContent = error.message;
        } else if (paymentIntent.status === "succeeded") {
          alert("Payment succeeded!");
        }
      });
    </script>
  </body>
</html>
